{% extends 'base.html' %}
{% load static %}

{% block title %}Realizacje | czystepanele.pl{% endblock %}

{% block meta %}
  <meta name="description" content="Zobacz nasze realizacje czyszczenia paneli, okien i innych usÅ‚ug. Estetyka, jakoÅ›Ä‡, efekty. PrzeglÄ…daj konkretne kategorie i zainspiruj siÄ™.">
{% endblock %}

{% block content %}
<section class="relative bg-white pt-36 sm:pt-40 pb-20 sm:pb-24 lg:pb-32 px-4 sm:px-10 lg:px-16">
  <h1 class="text-4xl sm:text-5xl font-bold text-[#000042] text-center mb-12">
      Realizacje
  </h1>
    <div class="max-w-7xl mx-auto">

      <!-- ðŸ”¹ FILTRY -->
      <div class="flex flex-wrap justify-center gap-3 mb-12">

        <button 
          class="category-filter active bg-gray-900 text-white px-4 py-2 rounded-full hover:bg-gray-800 font-medium transition"
          data-category-id="all">
          Wszystkie
        </button>

        {% for category in categories %}
          <button 
            class="category-filter bg-gray-200 text-gray-800 px-4 py-2 rounded-full hover:bg-gray-300 font-medium transition"
            data-category-id="{{ category.id }}">
            {{ category.name }}
          </button>
        {% endfor %}

        <!-- ðŸ”¸ Sort -->
        <div class="flex items-center gap-2 ml-6">
          <span class="text-gray-700 font-medium">Sortuj:</span>
          <button id="sort-desc" class="sort-btn bg-gray-200 px-3 py-1 rounded hover:bg-gray-300">Najnowsze</button>
          <button id="sort-asc" class="sort-btn bg-gray-200 px-3 py-1 rounded hover:bg-gray-300">Najstarsze</button>
        </div>
      </div>

      <!-- ðŸ”¹ GRID PROJEKTÃ“W -->
      <div id="project-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">

        {% for project in projects %}
          <a href="{{ project.get_absolute_url }}" 
            class="project-card block bg-white rounded-xl shadow hover:shadow-lg overflow-hidden transition-all duration-300"
            data-category-id="{{ project.category.id }}"
            data-date="{{ project.date|date:'Y-m-d' }}">

            <div class="relative w-full aspect-square">
              {% if project.main_image %}
                <img src="{{ project.main_image.url }}" 
                    alt="{{ project.title }}" 
                    class="absolute inset-0 w-full h-full object-cover"
                    loading="lazy">
              {% else %}
                <div class="absolute inset-0 flex items-center justify-center bg-gray-200 text-gray-500">
                  Brak zdjÄ™cia
                </div>
              {% endif %}
            </div>

            <div class="p-5">
              <h3 class="text-lg font-semibold text-gray-900 mb-1">{{ project.title }}</h3>

              {% if project.company_name %}
                <p class="text-sm text-gray-700">{{ project.company_name }}</p>
              {% endif %}

              <p class="text-sm text-gray-500">
                {{ project.location }} &bull; {{ project.date|date:"m.Y" }}
              </p>
            </div>
          </a>
        {% endfor %}

      </div>

    </div>
</section>

<script>
  // =============================
  // ðŸ”¹ Filtrowanie kategorii
  // =============================
  document.querySelectorAll('.category-filter').forEach(btn => {
    btn.addEventListener('click', () => {

      document.querySelectorAll('.category-filter').forEach(x => x.classList.remove('active', 'bg-gray-900', 'text-white'));
      btn.classList.add('active', 'bg-gray-900', 'text-white');

      const id = btn.dataset.categoryId;
      document.querySelectorAll('.project-card').forEach(card => {
        card.classList.toggle('hidden', !(id === "all" || card.dataset.categoryId === id));
      });
    });
  });

  // =============================
  // ðŸ”¹ Sortowanie dat
  // =============================
  const grid = document.getElementById('project-grid');

  function sortProjects(asc=true) {
    const cards = [...grid.querySelectorAll('.project-card')];
    cards.sort((a,b) => {
      const A = new Date(a.dataset.date);
      const B = new Date(b.dataset.date);
      return asc ? A - B : B - A;
    });
    cards.forEach(c => grid.appendChild(c));
  }

  document.getElementById('sort-asc').onclick = () => sortProjects(true);
  document.getElementById('sort-desc').onclick = () => sortProjects(false);

  // ðŸ”¹ DomyÅ›lnie najnowsze
  document.addEventListener('DOMContentLoaded', () => sortProjects(false));
</script>

<style>
  .category-filter.active {
    background: #111827 !important;
    color: white !important;
  }
</style>
{% endblock %}
